# AtCoder-heuristic-Contest048
## Contest time 5/30 19:00～6/9 19:00


## Question



## plan

### 5/30(1日目)
１．解法:２本混ぜ最もターゲットの色に近い色を作る
 * 1. 仕切りを全部下げて連結ウェルを1つにする
 * 2. 2本のチューブから色を混ぜて、ターゲットの色に最も近い色を作る

 絶対得点135,779,851、相対得点：3,369,391,521  パフォ1005 (5/31 0:29時点)

 2.解法　仕切り等を使っていないため使う
 =>仕切る方法で得点変わってくる？
 ＝＞どうやって仕切る？

 解法:２本混ぜ最もターゲットの色に近い色を作る
 * 1. 4マス正方形（2x2）のウェルを作る
 * 2. 2本のチューブから色を混ぜて、ターゲットの色に最も近い色を作る

 絶対得点166,336,640、相対得点：3,169,555,693  パフォ956 (5/31 0:29時点) 下がった

 ここで勘違い発覚　絶対得点は小さいほうがいい

 解法３：貪欲法使用する
 1つ目のターゲット色を適当に選び、以降は「現在の色に最も近い未使用のターゲット色」を順に選んで並べる。

#### 解法4：TSP順序最適化＋全仕切り下げ＋再利用
- 1. 仕切りを全て下げてパレット全体を1つの大ウェルにする  
- 2. ターゲット色の順序をTSP（巡回セールスマン問題）近似（Nearest Neighbor法＋2-opt）で最適化  
- 3. 直前に作った色が十分近ければ再利用し、操作回数・誤差を抑える  
- 4. 1本注ぎで十分近い場合は1本だけ注ぐ。どちらもダメなら2本混ぜで最適な比率を探索

絶対得点：135,295,432　相対得点：2,898,549,433　パフォ973（5/31時点2:30） 最高得点

**工夫ポイント**
- 色順序最適化で色移動距離を短縮
- 仕切りを使わず全体を大ウェル化し、色の再利用を最大化
- 2-opt法で色順序をさらに改善
- 1本注ぎ・既存色再利用で操作回数を削減
 
次から大ウェルから＝＞区切り付けて考える
問題を吟味して考える(方針　得点上げ方)
目標　相対得点50億！！


### 5/31(2日目)

#### 解法５(仕切り追加に混色に力入れる)
5×5のウェル（wellSize=4, N=20で25個）に分割し、
 * まず全てのウェルに色を1gずつ入れてから調整を始める。
 * 
 * 各ターゲット色ごとに：
 *   1. 全ウェルから最も近い色を探索し、1g以上あればそのまま渡す。
 *   2. 追加注ぎ（動作1）で近づく場合は追加して渡す。
 *   3. 動作4（隣接マス間の仕切りを外して混ぜる）で近づく場合は混ぜて渡す。
 *   4. それでもダメなら一番近いウェルを上書きして渡す。
 * 
 * 各ウェルのグラム数を管理し、1g未満の場合は渡せない・混ぜられないようにしている。
 * 動作4はマス単位で隣接判定し、正しく混合できるようにしている。

 絶対得点：63,232,152　相対得点：3,791,025,935　パフォ1404（5/31時点15:13） 

#### 解法6（混色＋追加注ぎ全探索）

5×5のウェル（wellSize=4, N=20で25個）に分割し、  
まず全てのウェルに色を1gずつ入れてから調整を始める。

各ターゲット色ごとに：
 1. 全ウェルから最も近い色を探索し、1g以上あればそのまま渡す。
 2. 追加注ぎ（動作1）で近づく場合は追加して渡す。
 3. 動作4（隣接マス間の仕切りを外して混ぜる）で近づく場合は混ぜて渡す。
 4. **さらに、混ぜた後に追加注ぎ（動作1）も全チューブで試し、より近づく場合はその操作を選ぶ。**
 5. それでもダメなら一番近いウェルを上書きして渡す。

各ウェルのグラム数を管理し、1g未満の場合は渡せない・混ぜられないようにしている。  
動作4はマス単位で隣接判定し、正しく混合できるようにしている。

**改善点**  
- 混ぜるだけでなく「混ぜてから追加注ぎ」も全チューブで試すことで、よりターゲット色に近い色を作れる場合を考慮。
- これにより、従来よりも誤差が小さくなるケースが増え、スコア向上が期待できる。

絶対得点：53,661,869　相対得点：2,886,143,049　パフォ1467（5/31時点19:25） 


**目標：絶対得点 25,000,000 を目指してさらに改善中！**


#### 仕切りの使い方

- パレット全体を5×5のウェル（wellSize=4, N=20で25個）に分割し、各ウェルごとに色を管理することで、色の混ざりを制御しやすくしている。
- 仕切り（動作4）は「隣接する2つのウェル間」でのみ外すことができ、混ぜたい時だけピンポイントで混色できる。
- これにより、不要な色の混ざりを防ぎつつ、必要な時だけ混色してターゲット色に近づけることができる。
- 仕切りを外す位置・タイミングを工夫することで、混色パターンの多様性と色の再利用効率を両立している。

#### 破棄する条件

- 各ウェルのグラム数が1g未満の場合、そのウェルの色は納品や混色に使えない（破棄扱い）。
- また、ターゲット色に対してどの操作（追加注ぎ・混色・混ぜて追加注ぎ）でも十分近づけない場合は、既存の色を「上書き」して新しい色を作る（実質的に破棄して再利用）。
- 今後の改善案として、「誤差が大きい色」や「今後使い道がなさそうな色」を積極的に破棄・上書きする戦略を導入することで、より効率的な色管理ができる可能性がある。

#### 解法７

## 全体の流れ

1. **パレットの仕切りを出力し、5×5のウェル構造を作る。**
2. **各ウェルにチューブ色を順番に1gずつ入れる（初期化）。**
3. **各ターゲット色ごとに、以下の操作を最適な組み合わせで選択し納品する：**
    - そのまま納品（既存ウェルの色が近い場合）
    - 追加注ぎ（既存ウェルにチューブ色を加えて混ぜる）
    - 混合（隣接する2つのウェルを混ぜる）
    - 混合＋追加注ぎ（混合後さらにチューブ色を加えて混ぜる）
    - 使えるウェルがない場合は空きウェルに新たに色を追加

---

## 工夫点

- 納品・追加注ぎ・混合・混合＋追加注ぎの**全組み合わせを全探索**し、ターゲット色に最も近づく操作を選択します。
- 各ウェルの色（RGB）と残量（グラム数）を管理し、**1g未満のウェルは使わない**ようにしています。
- 混合は**マス単位で隣接判定**し、正しく混ぜられるようにしています。
- 納品後や混合後のウェルの状態も**正しく更新**します。

---

## 注意点

- 動作1: 色を追加（追加注ぎ）、動作2: 納品、動作4: 混合（仕切りを外して混ぜる）を出力します。
- 動作3（破棄）は本実装では使用していません。
- 最大ターン数TやコストDは本実装では未使用です。

---

### スコア

- 絶対得点：52,890,065
- 相対得点：2,260,549,098
- パフォ1439（6/1時点0:00）

---

#### 解法８

**全ての納品・追加注ぎ・混合・混合＋追加注ぎの全組み合わせを全探索**し、ターゲット色に最も近い操作を必ず選択する。
    - 追加注ぎは「全ウェル×全チューブ」、
    - 混合・混合＋追加注ぎは「全ウェルペア×全隣接マス×全チューブ」を全て試す。
- 各ウェルの色（RGB）と残量（グラム数）を厳密に管理し、1g未満のウェルは使わない。
- 混合はマス単位で隣接判定し、正しく混ぜられるようにしている。
- 納品後や混合後のウェルの状態も正しく更新。
- 既存ウェルや混合で十分近い色が作れない場合は、**空きウェルに最も近いチューブ色を新規投入して納品**する。
- 使い回しペナルティ（同じウェルの連続利用や使用回数）も考慮し、色の偏りを防ぐ。
- 動作3（破棄）は現状未使用だが、今後の改善余地あり。
- **従来よりも圧倒的に多くの組み合わせを探索することで、色の精度・柔軟性が大幅に向上**している。

### スコア

- 絶対得点：22,811,033	
- 相対得点：5,186,245,852 
- パフォ1963（6/1時点3:00）
- 現状84位

